<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma OTT Educativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, updateDoc, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCu-GYKblx8v94XMLeIEbpwpxJjxmihyaE",
            authDomain: "plataforma-ott.firebaseapp.com",
            projectId: "plataforma-ott",
            storageBucket: "plataforma-ott.firebasestorage.app",
            messagingSenderId: "623885901425",
            appId: "1:623885901425:web:d3fa5079d942eb064a05d0"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let currentVideo = null;
        let videoPlayer = null;
        let checkInterval = null;
        let questionShown = {};

        // Base de datos de videos educativos con preguntas
        const videosDatabase = [
            {
                id: 1,
                title: "Introducci√≥n a la Programaci√≥n",
                description: "Conceptos b√°sicos de programaci√≥n y algoritmos",
                category: "Programaci√≥n",
                thumbnail: "https://img.youtube.com/vi/N77mJGEl6B0/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/N77mJGEl6B0",
                duration: "15:30",
                questions: [
                    {
                        time: 30,
                        question: "¬øQu√© es un algoritmo?",
                        options: [
                            "Un lenguaje de programaci√≥n",
                            "Una secuencia de pasos para resolver un problema",
                            "Un tipo de variable",
                            "Un editor de c√≥digo"
                        ],
                        correct: 1
                    },
                    {
                        time: 180,
                        question: "¬øCu√°l es el primer paso al programar?",
                        options: [
                            "Escribir c√≥digo inmediatamente",
                            "Analizar y entender el problema",
                            "Elegir un lenguaje de programaci√≥n",
                            "Comprar una computadora nueva"
                        ],
                        correct: 1
                    },
                    {
                        time: 360,
                        question: "¬øQu√© significa 'debuggear'?",
                        options: [
                            "Eliminar el c√≥digo",
                            "Buscar y corregir errores",
                            "Ejecutar el programa",
                            "Comentar el c√≥digo"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 2,
                title: "JavaScript para Principiantes",
                description: "Aprende los fundamentos de JavaScript desde cero",
                category: "Programaci√≥n",
                thumbnail: "https://img.youtube.com/vi/RqQ1d1qEWlE/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/RqQ1d1qEWlE",
                duration: "25:45",
                questions: [
                    {
                        time: 45,
                        question: "¬øQu√© tipo de lenguaje es JavaScript?",
                        options: [
                            "Compilado",
                            "Interpretado",
                            "Ensamblador",
                            "Binario"
                        ],
                        correct: 1
                    },
                    {
                        time: 240,
                        question: "¬øC√≥mo se declara una variable en JavaScript moderno?",
                        options: [
                            "var nombre",
                            "let nombre o const nombre",
                            "variable nombre",
                            "dim nombre"
                        ],
                        correct: 1
                    },
                    {
                        time: 480,
                        question: "¬øQu√© es el DOM?",
                        options: [
                            "Un editor de c√≥digo",
                            "Document Object Model",
                            "Un lenguaje de programaci√≥n",
                            "Una base de datos"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 3,
                title: "Bases de Datos SQL",
                description: "Fundamentos de bases de datos relacionales y SQL",
                category: "Bases de Datos",
                thumbnail: "https://img.youtube.com/vi/uUdKAYl-F7g/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/uUdKAYl-F7g",
                duration: "20:15",
                questions: [
                    {
                        time: 60,
                        question: "¬øQu√© significa SQL?",
                        options: [
                            "Simple Query Language",
                            "Structured Query Language",
                            "System Quality Language",
                            "Standard Question Language"
                        ],
                        correct: 1
                    },
                    {
                        time: 300,
                        question: "¬øQu√© comando se usa para consultar datos?",
                        options: [
                            "GET",
                            "SELECT",
                            "FIND",
                            "QUERY"
                        ],
                        correct: 1
                    },
                    {
                        time: 600,
                        question: "¬øQu√© es una clave primaria?",
                        options: [
                            "Una contrase√±a",
                            "Un identificador √∫nico de registro",
                            "Un tipo de dato",
                            "Una tabla"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 4,
                title: "Desarrollo Web Responsivo",
                description: "Crea sitios web que se adapten a cualquier dispositivo",
                category: "Dise√±o Web",
                thumbnail: "https://img.youtube.com/vi/srvUrASNj0s/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/srvUrASNj0s",
                duration: "18:20",
                questions: [
                    {
                        time: 40,
                        question: "¬øQu√© es el dise√±o responsivo?",
                        options: [
                            "Dise√±o que responde r√°pido",
                            "Dise√±o que se adapta a diferentes tama√±os de pantalla",
                            "Dise√±o con colores vibrantes",
                            "Dise√±o minimalista"
                        ],
                        correct: 1
                    },
                    {
                        time: 220,
                        question: "¬øQu√© unidad es mejor para dise√±o responsivo?",
                        options: [
                            "px (p√≠xeles)",
                            "rem o % (relativos)",
                            "cm (cent√≠metros)",
                            "pt (puntos)"
                        ],
                        correct: 1
                    },
                    {
                        time: 540,
                        question: "¬øQu√© son los media queries?",
                        options: [
                            "Consultas de bases de datos",
                            "Reglas CSS para diferentes dispositivos",
                            "Preguntas frecuentes",
                            "Tipos de archivos multimedia"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 5,
                title: "Git y GitHub",
                description: "Control de versiones para desarrolladores",
                category: "Herramientas",
                thumbnail: "https://img.youtube.com/vi/mBYSUUnMt9M/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/mBYSUUnMt9M",
                duration: "22:10",
                questions: [
                    {
                        time: 50,
                        question: "¬øQu√© es Git?",
                        options: [
                            "Una red social",
                            "Un sistema de control de versiones",
                            "Un lenguaje de programaci√≥n",
                            "Un editor de texto"
                        ],
                        correct: 1
                    },
                    {
                        time: 280,
                        question: "¬øQu√© comando crea un nuevo repositorio?",
                        options: [
                            "git start",
                            "git init",
                            "git create",
                            "git new"
                        ],
                        correct: 1
                    },
                    {
                        time: 660,
                        question: "¬øQu√© es un commit?",
                        options: [
                            "Borrar archivos",
                            "Guardar cambios en el historial",
                            "Subir archivos a internet",
                            "Crear una carpeta"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 6,
                title: "Python para Data Science",
                description: "An√°lisis de datos con Python y sus bibliotecas",
                category: "Data Science",
                thumbnail: "https://img.youtube.com/vi/_uQrJ0TkZlc/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/_uQrJ0TkZlc",
                duration: "30:00",
                questions: [
                    {
                        time: 70,
                        question: "¬øQu√© biblioteca se usa para manipular datos?",
                        options: [
                            "NumPy",
                            "Pandas",
                            "Matplotlib",
                            "Django"
                        ],
                        correct: 1
                    },
                    {
                        time: 420,
                        question: "¬øQu√© es un DataFrame?",
                        options: [
                            "Un tipo de gr√°fico",
                            "Una estructura de datos tabular",
                            "Un marco de trabajo",
                            "Un archivo de video"
                        ],
                        correct: 1
                    },
                    {
                        time: 900,
                        question: "¬øQu√© biblioteca se usa para visualizaci√≥n?",
                        options: [
                            "Pandas",
                            "Matplotlib o Seaborn",
                            "NumPy",
                            "Requests"
                        ],
                        correct: 1
                    }
                ]
            }
        ];

        function showMessage(type, text) {
            const messageDiv = document.getElementById('message');
            if (!messageDiv) return;
            
            messageDiv.className = `flex items-center gap-2 p-4 rounded-lg mb-6 ${type === 'error' ? 'bg-red-500/20 border border-red-500/50' : 'bg-green-500/20 border border-green-500/50'}`;
            messageDiv.innerHTML = `
                <span class="text-2xl">${type === 'error' ? '‚ö†Ô∏è' : '‚úÖ'}</span>
                <span class="${type === 'error' ? 'text-red-300' : 'text-green-300'}">${text}</span>
            `;
            messageDiv.style.display = 'flex';
            
            if (type === 'success') {
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 3000);
            }
        }

        async function handleRegister() {
            const name = document.getElementById('reg-name').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm').value;

            if (!name || !email || !password || !confirmPassword) {
                showMessage('error', 'Todos los campos son obligatorios');
                return;
            }

            if (password !== confirmPassword) {
                showMessage('error', 'Las contrase√±as no coinciden');
                return;
            }

            if (password.length < 6) {
                showMessage('error', 'La contrase√±a debe tener al menos 6 caracteres');
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                await setDoc(doc(db, 'users', user.uid), {
                    name: name,
                    email: email,
                    createdAt: new Date().toISOString(),
                    subscription: 'basic',
                    stats: {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        wrongAnswers: 0,
                        videosWatched: []
                    }
                });

                showMessage('success', '¬°Registro exitoso! Redirigiendo...');
                
                setTimeout(() => {
                    document.getElementById('reg-name').value = '';
                    document.getElementById('reg-email').value = '';
                    document.getElementById('reg-password').value = '';
                    document.getElementById('reg-confirm').value = '';
                    switchToLogin();
                }, 2000);

            } catch (error) {
                console.error('Error:', error);
                let errorMessage = 'Error al registrar usuario';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Este email ya est√° registrado';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email inv√°lido';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'La contrase√±a es muy d√©bil';
                }
                
                showMessage('error', errorMessage);
            }
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                showMessage('error', 'Email y contrase√±a son obligatorios');
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showMessage('success', 'Iniciando sesi√≥n...');
                
            } catch (error) {
                console.error('Error:', error);
                let errorMessage = 'Error al iniciar sesi√≥n';
                
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Usuario no encontrado';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Contrase√±a incorrecta';
                } else if (error.code === 'auth/invalid-credential') {
                    errorMessage = 'Email o contrase√±a incorrectos';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Demasiados intentos. Intenta m√°s tarde';
                }
                
                showMessage('error', errorMessage);
            }
        }

        async function handleLogout() {
            try {
                await signOut(auth);
                currentVideo = null;
                if (checkInterval) clearInterval(checkInterval);
                showMessage('success', 'Sesi√≥n cerrada exitosamente');
            } catch (error) {
                console.error('Error:', error);
                showMessage('error', 'Error al cerrar sesi√≥n');
            }
        }

        function renderLoginPage() {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
                    <div class="bg-gray-800/50 backdrop-blur-lg rounded-2xl shadow-2xl p-8 w-full max-w-md border border-purple-500/20">
                        <div class="text-center mb-8">
                            <div class="text-6xl mb-4">üéì</div>
                            <h1 class="text-4xl font-bold text-white mb-2">OTT Educativa</h1>
                            <p class="text-gray-400">Aprende con videos interactivos üî•</p>
                        </div>

                        <div id="message" style="display: none;"></div>

                        <div class="flex gap-2 mb-6 bg-gray-700/30 p-1 rounded-lg">
                            <button id="btn-login-tab" class="flex-1 py-2 px-4 rounded-md transition-all bg-gradient-to-r from-purple-500 to-pink-500 text-white">
                                Iniciar Sesi√≥n
                            </button>
                            <button id="btn-register-tab" class="flex-1 py-2 px-4 rounded-md transition-all text-gray-400 hover:text-white">
                                Registrarse
                            </button>
                        </div>

                        <div id="login-form">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üìß Email</label>
                                    <input type="email" id="login-email" placeholder="tu@email.com" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üîí Contrase√±a</label>
                                    <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <button id="btn-login" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105">
                                    Iniciar Sesi√≥n
                                </button>
                            </div>
                        </div>

                        <div id="register-form" style="display: none;">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üë§ Nombre Completo</label>
                                    <input type="text" id="reg-name" placeholder="Juan P√©rez" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üìß Email</label>
                                    <input type="email" id="reg-email" placeholder="tu@email.com" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üîí Contrase√±a (m√≠n. 6 caracteres)</label>
                                    <input type="password" id="reg-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üîí Confirmar Contrase√±a</label>
                                    <input type="password" id="reg-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <button id="btn-register" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105">
                                    Crear Cuenta
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('btn-login-tab').addEventListener('click', switchToLogin);
            document.getElementById('btn-register-tab').addEventListener('click', switchToRegister);
            document.getElementById('btn-login').addEventListener('click', handleLogin);
            document.getElementById('btn-register').addEventListener('click', handleRegister);
        }

        function switchToLogin() {
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('btn-login-tab').className = 'flex-1 py-2 px-4 rounded-md transition-all bg-gradient-to-r from-purple-500 to-pink-500 text-white';
            document.getElementById('btn-register-tab').className = 'flex-1 py-2 px-4 rounded-md transition-all text-gray-400 hover:text-white';
            
            const messageDiv = document.getElementById('message');
            if (messageDiv) messageDiv.style.display = 'none';
        }

        function switchToRegister() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
            document.getElementById('btn-login-tab').className = 'flex-1 py-2 px-4 rounded-md transition-all text-gray-400 hover:text-white';
            document.getElementById('btn-register-tab').className = 'flex-1 py-2 px-4 rounded-md transition-all bg-gradient-to-r from-purple-500 to-pink-500 text-white';
            
            const messageDiv = document.getElementById('message');
            if (messageDiv) messageDiv.style.display = 'none';
        }

        async function renderDashboard(user) {
            try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                const userData = userDoc.data();

                const categories = [...new Set(videosDatabase.map(v => v.category))];

                document.getElementById('root').innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
                        <!-- Header -->
                        <nav class="bg-gray-800/50 backdrop-blur-lg border-b border-purple-500/20 sticky top-0 z-50">
                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div class="flex items-center justify-between h-16">
                                    <div class="flex items-center gap-3">
                                        <span class="text-3xl">üéì</span>
                                        <h1 class="text-xl font-bold text-white">OTT Educativa</h1>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <button id="btn-stats" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all flex items-center gap-2">
                                            üìä Estad√≠sticas
                                        </button>
                                        <button id="btn-logout" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all">
                                            Cerrar Sesi√≥n
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </nav>

                        <!-- Main Content -->
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            <div id="message" style="display: none;"></div>

                            <!-- Welcome Section -->
                            <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-xl p-6 mb-8 border border-purple-500/30">
                                <h2 class="text-2xl font-bold text-white mb-2">¬°Bienvenido, ${userData.name}! üëã</h2>
                                <p class="text-gray-300">Explora nuestros videos educativos interactivos con preguntas integradas</p>
                            </div>

                            <!-- Categories Filter -->
                            <div class="mb-6 flex gap-3 flex-wrap">
                                <button class="category-btn px-4 py-2 rounded-lg bg-purple-500 text-white" data-category="all">
                                    Todos
                                </button>
                                ${categories.map(cat => `
                                    <button class="category-btn px-4 py-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600" data-category="${cat}">
                                        ${cat}
                                    </button>
                                `).join('')}
                            </div>

                            <!-- Videos Grid -->
                            <div id="videos-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                ${videosDatabase.map(video => `
                                    <div class="video-card bg-gray-800/50 rounded-xl overflow-hidden border border-gray-700 hover:border-purple-500 transition-all cursor-pointer transform hover:scale-105" data-video-id="${video.id}" data-category="${video.category}">
                                        <div class="relative">
                                            <img src="${video.thumbnail}" alt="${video.title}" class="w-full h-48 object-cover">
                                            <div class="absolute bottom-2 right-2 bg-black/80 px-2 py-1 rounded text-white text-sm">
                                                ${video.duration}
                                            </div>
                                            <div class="absolute top-2 left-2 bg-purple-500 px-2 py-1 rounded text-white text-xs">
                                                ${video.questions.length} preguntas
                                            </div>
                                        </div>
                                        <div class="p-4">
                                            <h3 class="text-white font-semibold mb-2">${video.title}</h3>
                                            <p class="text-gray-400 text-sm mb-3">${video.description}</p>
                                            <span class="inline-block bg-gray-700 text-gray-300 px-3 py-1 rounded-full text-xs">
                                                ${video.category}
                                            </span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                // Event Listeners
                document.getElementById('btn-logout').addEventListener('click', handleLogout);
                document.getElementById('btn-stats').addEventListener('click', () => showStats(userData));

                // Category filter
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.category-btn').forEach(b => {
                            b.className = 'category-btn px-4 py-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600';
                        });
                        e.target.className = 'category-btn px-4 py-2 rounded-lg bg-purple-500 text-white';

                        const category = e.target.dataset.category;
                        document.querySelectorAll('.video-card').forEach(card => {
                            if (category === 'all' || card.dataset.category === category) {
                                card.style.display = 'block';
                            } else {
                                card.style.display = 'none';
                            }
                        });
                    });
                });

                // Video cards
                document.querySelectorAll('.video-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const videoId = parseInt(card.dataset.videoId);
                        openVideoPlayer(videoId);
                    });
                });
                
            } catch (error) {
                console.error('Error al cargar datos:', error);
                showMessage('error', 'Error al cargar informaci√≥n del usuario');
            }
        }

        function openVideoPlayer(videoId) {
            currentVideo = videosDatabase.find(v => v.id === videoId);
            questionShown = {};

            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
                    <!-- Header -->
                    <nav class="bg-gray-800/50 backdrop-blur-lg border-b border-purple-500/20">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="flex items-center justify-between h-16">
                                <button id="btn-back" class="text-white hover:text-purple-400 transition-all flex items-center gap-2">
                                    ‚Üê Volver al cat√°logo
                                </button>
                                <h1 class="text-white font-semibold">${current
                                                                       <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma OTT Educativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, updateDoc, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCu-GYKblx8v94XMLeIEbpwpxJjxmihyaE",
            authDomain: "plataforma-ott.firebaseapp.com",
            projectId: "plataforma-ott",
            storageBucket: "plataforma-ott.firebasestorage.app",
            messagingSenderId: "623885901425",
            appId: "1:623885901425:web:d3fa5079d942eb064a05d0"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let currentVideo = null;
        let videoPlayer = null;
        let checkInterval = null;
        let questionShown = {};

        // Base de datos de videos educativos con preguntas
        const videosDatabase = [
            {
                id: 1,
                title: "Introducci√≥n a la Programaci√≥n",
                description: "Conceptos b√°sicos de programaci√≥n y algoritmos",
                category: "Programaci√≥n",
                thumbnail: "https://img.youtube.com/vi/N77mJGEl6B0/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/N77mJGEl6B0",
                duration: "15:30",
                questions: [
                    {
                        time: 30,
                        question: "¬øQu√© es un algoritmo?",
                        options: [
                            "Un lenguaje de programaci√≥n",
                            "Una secuencia de pasos para resolver un problema",
                            "Un tipo de variable",
                            "Un editor de c√≥digo"
                        ],
                        correct: 1
                    },
                    {
                        time: 180,
                        question: "¬øCu√°l es el primer paso al programar?",
                        options: [
                            "Escribir c√≥digo inmediatamente",
                            "Analizar y entender el problema",
                            "Elegir un lenguaje de programaci√≥n",
                            "Comprar una computadora nueva"
                        ],
                        correct: 1
                    },
                    {
                        time: 360,
                        question: "¬øQu√© significa 'debuggear'?",
                        options: [
                            "Eliminar el c√≥digo",
                            "Buscar y corregir errores",
                            "Ejecutar el programa",
                            "Comentar el c√≥digo"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 2,
                title: "JavaScript para Principiantes",
                description: "Aprende los fundamentos de JavaScript desde cero",
                category: "Programaci√≥n",
                thumbnail: "https://img.youtube.com/vi/RqQ1d1qEWlE/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/RqQ1d1qEWlE",
                duration: "25:45",
                questions: [
                    {
                        time: 45,
                        question: "¬øQu√© tipo de lenguaje es JavaScript?",
                        options: [
                            "Compilado",
                            "Interpretado",
                            "Ensamblador",
                            "Binario"
                        ],
                        correct: 1
                    },
                    {
                        time: 240,
                        question: "¬øC√≥mo se declara una variable en JavaScript moderno?",
                        options: [
                            "var nombre",
                            "let nombre o const nombre",
                            "variable nombre",
                            "dim nombre"
                        ],
                        correct: 1
                    },
                    {
                        time: 480,
                        question: "¬øQu√© es el DOM?",
                        options: [
                            "Un editor de c√≥digo",
                            "Document Object Model",
                            "Un lenguaje de programaci√≥n",
                            "Una base de datos"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 3,
                title: "Bases de Datos SQL",
                description: "Fundamentos de bases de datos relacionales y SQL",
                category: "Bases de Datos",
                thumbnail: "https://img.youtube.com/vi/uUdKAYl-F7g/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/uUdKAYl-F7g",
                duration: "20:15",
                questions: [
                    {
                        time: 60,
                        question: "¬øQu√© significa SQL?",
                        options: [
                            "Simple Query Language",
                            "Structured Query Language",
                            "System Quality Language",
                            "Standard Question Language"
                        ],
                        correct: 1
                    },
                    {
                        time: 300,
                        question: "¬øQu√© comando se usa para consultar datos?",
                        options: [
                            "GET",
                            "SELECT",
                            "FIND",
                            "QUERY"
                        ],
                        correct: 1
                    },
                    {
                        time: 600,
                        question: "¬øQu√© es una clave primaria?",
                        options: [
                            "Una contrase√±a",
                            "Un identificador √∫nico de registro",
                            "Un tipo de dato",
                            "Una tabla"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 4,
                title: "Desarrollo Web Responsivo",
                description: "Crea sitios web que se adapten a cualquier dispositivo",
                category: "Dise√±o Web",
                thumbnail: "https://img.youtube.com/vi/srvUrASNj0s/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/srvUrASNj0s",
                duration: "18:20",
                questions: [
                    {
                        time: 40,
                        question: "¬øQu√© es el dise√±o responsivo?",
                        options: [
                            "Dise√±o que responde r√°pido",
                            "Dise√±o que se adapta a diferentes tama√±os de pantalla",
                            "Dise√±o con colores vibrantes",
                            "Dise√±o minimalista"
                        ],
                        correct: 1
                    },
                    {
                        time: 220,
                        question: "¬øQu√© unidad es mejor para dise√±o responsivo?",
                        options: [
                            "px (p√≠xeles)",
                            "rem o % (relativos)",
                            "cm (cent√≠metros)",
                            "pt (puntos)"
                        ],
                        correct: 1
                    },
                    {
                        time: 540,
                        question: "¬øQu√© son los media queries?",
                        options: [
                            "Consultas de bases de datos",
                            "Reglas CSS para diferentes dispositivos",
                            "Preguntas frecuentes",
                            "Tipos de archivos multimedia"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 5,
                title: "Git y GitHub",
                description: "Control de versiones para desarrolladores",
                category: "Herramientas",
                thumbnail: "https://img.youtube.com/vi/mBYSUUnMt9M/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/mBYSUUnMt9M",
                duration: "22:10",
                questions: [
                    {
                        time: 50,
                        question: "¬øQu√© es Git?",
                        options: [
                            "Una red social",
                            "Un sistema de control de versiones",
                            "Un lenguaje de programaci√≥n",
                            "Un editor de texto"
                        ],
                        correct: 1
                    },
                    {
                        time: 280,
                        question: "¬øQu√© comando crea un nuevo repositorio?",
                        options: [
                            "git start",
                            "git init",
                            "git create",
                            "git new"
                        ],
                        correct: 1
                    },
                    {
                        time: 660,
                        question: "¬øQu√© es un commit?",
                        options: [
                            "Borrar archivos",
                            "Guardar cambios en el historial",
                            "Subir archivos a internet",
                            "Crear una carpeta"
                        ],
                        correct: 1
                    }
                ]
            },
            {
                id: 6,
                title: "Python para Data Science",
                description: "An√°lisis de datos con Python y sus bibliotecas",
                category: "Data Science",
                thumbnail: "https://img.youtube.com/vi/_uQrJ0TkZlc/maxresdefault.jpg",
                videoUrl: "https://www.youtube.com/embed/_uQrJ0TkZlc",
                duration: "30:00",
                questions: [
                    {
                        time: 70,
                        question: "¬øQu√© biblioteca se usa para manipular datos?",
                        options: [
                            "NumPy",
                            "Pandas",
                            "Matplotlib",
                            "Django"
                        ],
                        correct: 1
                    },
                    {
                        time: 420,
                        question: "¬øQu√© es un DataFrame?",
                        options: [
                            "Un tipo de gr√°fico",
                            "Una estructura de datos tabular",
                            "Un marco de trabajo",
                            "Un archivo de video"
                        ],
                        correct: 1
                    },
                    {
                        time: 900,
                        question: "¬øQu√© biblioteca se usa para visualizaci√≥n?",
                        options: [
                            "Pandas",
                            "Matplotlib o Seaborn",
                            "NumPy",
                            "Requests"
                        ],
                        correct: 1
                    }
                ]
            }
        ];

        function showMessage(type, text) {
            const messageDiv = document.getElementById('message');
            if (!messageDiv) return;
            
            messageDiv.className = `flex items-center gap-2 p-4 rounded-lg mb-6 ${type === 'error' ? 'bg-red-500/20 border border-red-500/50' : 'bg-green-500/20 border border-green-500/50'}`;
            messageDiv.innerHTML = `
                <span class="text-2xl">${type === 'error' ? '‚ö†Ô∏è' : '‚úÖ'}</span>
                <span class="${type === 'error' ? 'text-red-300' : 'text-green-300'}">${text}</span>
            `;
            messageDiv.style.display = 'flex';
            
            if (type === 'success') {
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 3000);
            }
        }

        async function handleRegister() {
            const name = document.getElementById('reg-name').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm').value;

            if (!name || !email || !password || !confirmPassword) {
                showMessage('error', 'Todos los campos son obligatorios');
                return;
            }

            if (password !== confirmPassword) {
                showMessage('error', 'Las contrase√±as no coinciden');
                return;
            }

            if (password.length < 6) {
                showMessage('error', 'La contrase√±a debe tener al menos 6 caracteres');
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                await setDoc(doc(db, 'users', user.uid), {
                    name: name,
                    email: email,
                    createdAt: new Date().toISOString(),
                    subscription: 'basic',
                    stats: {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        wrongAnswers: 0,
                        videosWatched: []
                    }
                });

                showMessage('success', '¬°Registro exitoso! Redirigiendo...');
                
                setTimeout(() => {
                    document.getElementById('reg-name').value = '';
                    document.getElementById('reg-email').value = '';
                    document.getElementById('reg-password').value = '';
                    document.getElementById('reg-confirm').value = '';
                    switchToLogin();
                }, 2000);

            } catch (error) {
                console.error('Error:', error);
                let errorMessage = 'Error al registrar usuario';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Este email ya est√° registrado';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email inv√°lido';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'La contrase√±a es muy d√©bil';
                }
                
                showMessage('error', errorMessage);
            }
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                showMessage('error', 'Email y contrase√±a son obligatorios');
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showMessage('success', 'Iniciando sesi√≥n...');
                
            } catch (error) {
                console.error('Error:', error);
                let errorMessage = 'Error al iniciar sesi√≥n';
                
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Usuario no encontrado';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Contrase√±a incorrecta';
                } else if (error.code === 'auth/invalid-credential') {
                    errorMessage = 'Email o contrase√±a incorrectos';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Demasiados intentos. Intenta m√°s tarde';
                }
                
                showMessage('error', errorMessage);
            }
        }

        async function handleLogout() {
            try {
                await signOut(auth);
                currentVideo = null;
                if (checkInterval) clearInterval(checkInterval);
                showMessage('success', 'Sesi√≥n cerrada exitosamente');
            } catch (error) {
                console.error('Error:', error);
                showMessage('error', 'Error al cerrar sesi√≥n');
            }
        }

        function renderLoginPage() {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
                    <div class="bg-gray-800/50 backdrop-blur-lg rounded-2xl shadow-2xl p-8 w-full max-w-md border border-purple-500/20">
                        <div class="text-center mb-8">
                            <div class="text-6xl mb-4">üéì</div>
                            <h1 class="text-4xl font-bold text-white mb-2">OTT Educativa</h1>
                            <p class="text-gray-400">Aprende con videos interactivos üî•</p>
                        </div>

                        <div id="message" style="display: none;"></div>

                        <div class="flex gap-2 mb-6 bg-gray-700/30 p-1 rounded-lg">
                            <button id="btn-login-tab" class="flex-1 py-2 px-4 rounded-md transition-all bg-gradient-to-r from-purple-500 to-pink-500 text-white">
                                Iniciar Sesi√≥n
                            </button>
                            <button id="btn-register-tab" class="flex-1 py-2 px-4 rounded-md transition-all text-gray-400 hover:text-white">
                                Registrarse
                            </button>
                        </div>

                        <div id="login-form">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üìß Email</label>
                                    <input type="email" id="login-email" placeholder="tu@email.com" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üîí Contrase√±a</label>
                                    <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <button id="btn-login" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105">
                                    Iniciar Sesi√≥n
                                </button>
                            </div>
                        </div>

                        <div id="register-form" style="display: none;">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üë§ Nombre Completo</label>
                                    <input type="text" id="reg-name" placeholder="Juan P√©rez" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üìß Email</label>
                                    <input type="email" id="reg-email" placeholder="tu@email.com" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üîí Contrase√±a (m√≠n. 6 caracteres)</label>
                                    <input type="password" id="reg-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2 text-sm">üîí Confirmar Contrase√±a</label>
                                    <input type="password" id="reg-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                        class="w-full bg-gray-700/50 border border-gray-600 rounded-lg py-3 px-4 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all">
                                </div>
                                <button id="btn-register" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105">
                                    Crear Cuenta
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('btn-login-tab').addEventListener('click', switchToLogin);
            document.getElementById('btn-register-tab').addEventListener('click', switchToRegister);
            document.getElementById('btn-login').addEventListener('click', handleLogin);
            document.getElementById('btn-register').addEventListener('click', handleRegister);
        }

        function switchToLogin() {
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('btn-login-tab').className = 'flex-1 py-2 px-4 rounded-md transition-all bg-gradient-to-r from-purple-500 to-pink-500 text-white';
            document.getElementById('btn-register-tab').className = 'flex-1 py-2 px-4 rounded-md transition-all text-gray-400 hover:text-white';
            
            const messageDiv = document.getElementById('message');
            if (messageDiv) messageDiv.style.display = 'none';
        }

        function switchToRegister() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
            document.getElementById('btn-login-tab').className = 'flex-1 py-2 px-4 rounded-md transition-all text-gray-400 hover:text-white';
            document.getElementById('btn-register-tab').className = 'flex-1 py-2 px-4 rounded-md transition-all bg-gradient-to-r from-purple-500 to-pink-500 text-white';
            
            const messageDiv = document.getElementById('message');
            if (messageDiv) messageDiv.style.display = 'none';
        }

        async function renderDashboard(user) {
            try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                const userData = userDoc.data();

                const categories = [...new Set(videosDatabase.map(v => v.category))];

                document.getElementById('root').innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
                        <!-- Header -->
                        <nav class="bg-gray-800/50 backdrop-blur-lg border-b border-purple-500/20 sticky top-0 z-50">
                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div class="flex items-center justify-between h-16">
                                    <div class="flex items-center gap-3">
                                        <span class="text-3xl">üéì</span>
                                        <h1 class="text-xl font-bold text-white">OTT Educativa</h1>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <button id="btn-stats" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all flex items-center gap-2">
                                            üìä Estad√≠sticas
                                        </button>
                                        <button id="btn-logout" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all">
                                            Cerrar Sesi√≥n
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </nav>

                        <!-- Main Content -->
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            <div id="message" style="display: none;"></div>

                            <!-- Welcome Section -->
                            <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-xl p-6 mb-8 border border-purple-500/30">
                                <h2 class="text-2xl font-bold text-white mb-2">¬°Bienvenido, ${userData.name}! üëã</h2>
                                <p class="text-gray-300">Explora nuestros videos educativos interactivos con preguntas integradas</p>
                            </div>

                            <!-- Categories Filter -->
                            <div class="mb-6 flex gap-3 flex-wrap">
                                <button class="category-btn px-4 py-2 rounded-lg bg-purple-500 text-white" data-category="all">
                                    Todos
                                </button>
                                ${categories.map(cat => `
                                    <button class="category-btn px-4 py-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600" data-category="${cat}">
                                        ${cat}
                                    </button>
                                `).join('')}
                            </div>

                            <!-- Videos Grid -->
                            <div id="videos-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                ${videosDatabase.map(video => `
                                    <div class="video-card bg-gray-800/50 rounded-xl overflow-hidden border border-gray-700 hover:border-purple-500 transition-all cursor-pointer transform hover:scale-105" data-video-id="${video.id}" data-category="${video.category}">
                                        <div class="relative">
                                            <img src="${video.thumbnail}" alt="${video.title}" class="w-full h-48 object-cover">
                                            <div class="absolute bottom-2 right-2 bg-black/80 px-2 py-1 rounded text-white text-sm">
                                                ${video.duration}
                                            </div>
                                            <div class="absolute top-2 left-2 bg-purple-500 px-2 py-1 rounded text-white text-xs">
                                                ${video.questions.length} preguntas
                                            </div>
                                        </div>
                                        <div class="p-4">
                                            <h3 class="text-white font-semibold mb-2">${video.title}</h3>
                                            <p class="text-gray-400 text-sm mb-3">${video.description}</p>
                                            <span class="inline-block bg-gray-700 text-gray-300 px-3 py-1 rounded-full text-xs">
                                                ${video.category}
                                            </span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                // Event Listeners
                document.getElementById('btn-logout').addEventListener('click', handleLogout);
                document.getElementById('btn-stats').addEventListener('click', () => showStats(userData));

                // Category filter
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.category-btn').forEach(b => {
                            b.className = 'category-btn px-4 py-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600';
                        });
                        e.target.className = 'category-btn px-4 py-2 rounded-lg bg-purple-500 text-white';

                        const category = e.target.dataset.category;
                        document.querySelectorAll('.video-card').forEach(card => {
                            if (category === 'all' || card.dataset.category === category) {
                                card.style.display = 'block';
                            } else {
                                card.style.display = 'none';
                            }
                        });
                    });
                });

                // Video cards
                document.querySelectorAll('.video-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const videoId = parseInt(card.dataset.videoId);
                        openVideoPlayer(videoId);
                    });
                });
                
            } catch (error) {
                console.error('Error al cargar datos:', error);
                showMessage('error', 'Error al cargar informaci√≥n del usuario');
            }
        }

        function openVideoPlayer(videoId) {
            currentVideo = videosDatabase.find(v => v.id === videoId);
            questionShown = {};

            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
                    <!-- Header -->
                    <nav class="bg-gray-800/50 backdrop-blur-lg border-b border-purple-500/20">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="flex items-center justify-between h-16">
                                <button id="btn-back" class="text-white hover:text-purple-400 transition-all flex items-center gap-2">
                                    ‚Üê Volver al cat√°logo
                                </button>
                                <h1 class="text-white font-semibold">${currentVideo.title}</h1>
                            </div>
                        </div>
                    </nav>

                    <!-- Video Player -->
                    <div class="max-w-6xl mx-auto px-4 py-8">
                        <div id="message" style="display: none;"></div>

                        <div class="bg-gray-800/50 rounded-xl overflow-hidden border border-purple-500/20 mb-6">
                            <div class="relative">
                                <iframe id="video-player" width="100%" height="500" 
                                    src="${currentVideo.videoUrl}?enablejsapi=1" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                                </iframe>
                                
                                <!-- Question Overlay -->
                                <div id="question-overlay" class="hidden absolute inset-0 bg-black/95 flex items-center justify-center p-4" style="z-index: 1000;">
                                    <div class="bg-gray-800 rounded-xl p-8 max-w-2xl w-full border-2 border-purple-500">
                                        <h3 class="text-2xl font-bold text-white mb-6" id="question-text"></h3>
                                        <div id="question-options" class="space-y-3 mb-6"></div>
                                        <div id="question-feedback" class="hidden"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Video Info -->
                        <div class="bg-gray-800/50 rounded-xl p-6 border border-gray-700">
                            <h2 class="text-2xl font-bold text-white mb-3">${currentVideo.title}</h2>
                            <p class="text-gray-300 mb-4">${currentVideo.description}</p>
                            <div class="flex gap-4 flex-wrap">
                                <span class="bg-purple-500/20 text-purple-300 px-4 py-2 rounded-lg">
                                    üìÇ ${currentVideo.category}
                                </span>
                                <span class="bg-blue-500/20 text-blue-300 px-4 py-2 rounded-lg">
                                    ‚è±Ô∏è ${currentVideo.duration}
                                </span>
                                <span class="bg-green-500/20 text-green-300 px-4 py-2 rounded-lg">
                                    ‚ùì ${currentVideo.questions.length} preguntas interactivas
                                </span>
                            </div>

                            <!-- Questions Timeline -->
                            <div class="mt-6">
                                <h3 class="text-white font-semibold mb-3">üìç Preguntas en este video:</h3>
                                <div class="space-y-2">
                                    ${currentVideo.questions.map((q, idx) => `
                                        <div class="bg-gray-700/50 p-3 rounded-lg">
                                            <span class="text-purple-400 font-semibold">Pregunta ${idx + 1}</span>
                                            <span class="text-gray-400 ml-3">‚è±Ô∏è ${formatTime(q.time)}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('btn-back').addEventListener('click', () => {
                if (checkInterval) clearInterval(checkInterval);
                renderDashboard(currentUser);
            });

            // Simulate video time checking (since YouTube API is limited in embedded mode)
            // In production, use YouTube IFrame API for precise control
            startQuestionChecker();
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function startQuestionChecker() {
            let currentTime = 0;
            
            // Simulate video playback time
            checkInterval = setInterval(() => {
                currentTime++;
                
                // Check if there's a question at this time
                const question = currentVideo.questions.find(q => 
                    q.time === currentTime && !questionShown[currentTime]
                );

                if (question) {
                    showQuestion(question, currentTime);
                }
            }, 1000);
        }

        function showQuestion(question, time) {
            questionShown[time] = true;
            
            const overlay = document.getElementById('question-overlay');
            const questionText = document.getElementById('question-text');
            const optionsDiv = document.getElementById('question-options');
            const feedbackDiv = document.getElementById('question-feedback');

            questionText.textContent = question.question;
            feedbackDiv.className = 'hidden';
            
            optionsDiv.innerHTML = question.options.map((option, idx) => `
                <button class="question-option w-full text-left p-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-all" data-index="${idx}">
                    <span class="font-semibold">${String.fromCharCode(65 + idx)}.</span> ${option}
                </button>
            `).join('');

            overlay.classList.remove('hidden');

            // Add event listeners to options
            document.querySelectorAll('.question-option').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const selectedIndex = parseInt(e.currentTarget.dataset.index);
                    const isCorrect = selectedIndex === question.correct;

                    // Disable all buttons
                    document.querySelectorAll('.question-option').forEach(b => {
                        b.disabled = true;
                        b.classList.remove('hover:bg-gray-600');
                    });

                    // Show feedback
                    if (isCorrect) {
                        e.currentTarget.classList.add('bg-green-500');
                        feedbackDiv.innerHTML = `
                            <div class="bg-green-500/20 border border-green-500 text-green-300 p-4 rounded-lg flex items-center gap-3">
                                <span class="text-3xl">‚úÖ</span>
                                <div>
                                    <p class="font-semibold">¬°Correcto!</p>
                                    <p class="text-sm">Excelente trabajo</p>
                                </div>
                            </div>
                        `;
                    } else {
                        e.currentTarget.classList.add('bg-red-500');
                        document.querySelectorAll('.question-option')[question.correct].classList.add('bg-green-500');
                        feedbackDiv.innerHTML = `
                            <div class="bg-red-500/20 border border-red-500 text-red-300 p-4 rounded-lg flex items-center gap-3">
                                <span class="text-3xl">‚ùå</span>
                                <div>
                                    <p class="font-semibold">Incorrecto</p>
                                    <p class="text-sm">La respuesta correcta es: ${question.options[question.correct]}</p>
                                </div>
                            </div>
                        `;
                    }

                    feedbackDiv.classList.remove('hidden');

                    // Update user stats in Firebase
                    await updateUserStats(isCorrect);

                    // Continue video after 3 seconds
                    setTimeout(() => {
                        overlay.classList.add('hidden');
                    }, 3000);
                });
            });
        }

        async function updateUserStats(isCorrect) {
            try {
                const userRef = doc(db, 'users', currentUser.uid);
                const userDoc = await getDoc(userRef);
                const userData = userDoc.data();

                const stats = userData.stats || {
                    totalQuestions: 0,
                    correctAnswers: 0,
                    wrongAnswers: 0,
                    videosWatched: []
                };

                stats.totalQuestions++;
                if (isCorrect) {
                    stats.correctAnswers++;
                } else {
                    stats.wrongAnswers++;
                }

                // Add video to watched list if not already there
                if (!stats.videosWatched.includes(currentVideo.id)) {
                    stats.videosWatched.push(currentVideo.id);
                }

                await updateDoc(userRef, { stats });

            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        async function showStats(userData) {
            const stats = userData.stats || {
                totalQuestions: 0,
                correctAnswers: 0,
                wrongAnswers: 0,
                videosWatched: []
            };

            const accuracy = stats.totalQuestions > 0 
                ? ((stats.correctAnswers / stats.totalQuestions) * 100).toFixed(1)
                : 0;

            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
                    <!-- Header -->
                    <nav class="bg-gray-800/50 backdrop-blur-lg border-b border-purple-500/20">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="flex items-center justify-between h-16">
                                <button id="btn-back-stats" class="text-white hover:text-purple-400 transition-all flex items-center gap-2">
                                    ‚Üê Volver al cat√°logo
                                </button>
                                <h1 class="text-white font-semibold">üìä Mis Estad√≠sticas</h1>
                            </div>
                        </div>
                    </nav>

                    <!-- Stats Content -->
                    <div class="max-w-6xl mx-auto px-4 py-8">
                        <div class="bg-gray-800/50 rounded-xl p-8 border border-purple-500/20 mb-6">
                            <h2 class="text-3xl font-bold text-white mb-6">Resumen de tu Progreso</h2>
                            
                            <!-- Main Stats -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-xl p-6">
                                    <div class="text-4xl mb-2">üìù</div>
                                    <div class="text-3xl font-bold text-white mb-1">${stats.totalQuestions}</div>
                                    <div class="text-gray-300 text-sm">Preguntas Respondidas</div>
                                </div>

                                <div class="bg-gradient-to-br from-green-500/20 to-green-600/20 border border-green-500/30 rounded-xl p-6">
                                    <div class="text-4xl mb-2">‚úÖ</div>
                                    <div class="text-3xl font-bold text-white mb-1">${stats.correctAnswers}</div>
                                    <div class="text-gray-300 text-sm">Respuestas Correctas</div>
                                </div>

                                <div class="bg-gradient-to-br from-red-500/20 to-red-600/20 border border-red-500/30 rounded-xl p-6">
                                    <div class="text-4xl mb-2">‚ùå</div>
                                    <div class="text-3xl font-bold text-white mb-1">${stats.wrongAnswers}</div>
                                    <div class="text-gray-300 text-sm">Respuestas Incorrectas</div>
                                </div>

                                <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-xl p-6">
                                    <div class="text-4xl mb-2">üéØ</div>
                                    <div class="text-3xl font-bold text-white mb-1">${accuracy}%</div>
                                    <div class="text-gray-300 text-sm">Precisi√≥n</div>
                                </div>
                            </div>

                            <!-- Accuracy Bar -->
                            <div class="mb-8">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-white font-semibold">Nivel de Aprendizaje</span>
                                    <span class="text-purple-400 font-semibold">${accuracy}%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-full transition-all duration-1000" 
                                         style="width: ${accuracy}%"></div>
                                </div>
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span>Principiante</span>
                                    <span>Intermedio</span>
                                    <span>Avanzado</span>
                                    <span>Experto</span>
                                </div>
                            </div>

                            <!-- Videos Watched -->
                            <div class="bg-gray-700/30 rounded-xl p-6">
                                <h3 class="text-xl font-semibold text-white mb-4">
                                    üé¨ Videos Vistos: ${stats.videosWatched.length} de ${videosDatabase.length}
                                </h3>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    ${videosDatabase.map(video => {
                                        const watched = stats.videosWatched.includes(video.id);
                                        return `
                                            <div class="bg-gray-600/30 rounded-lg p-3 flex items-center gap-3 ${watched ? 'border-2 border-green-500' : 'border border-gray-600'}">
                                                <span class="text-2xl">${watched ? '‚úÖ' : '‚è∏Ô∏è'}</span>
                                                <span class="text-white text-sm">${video.title}</span>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>

                        <!-- Performance Message -->
                        <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-xl p-6 border border-purple-500/30">
                            <h3 class="text-xl font-semibold text-white mb-3">
                                ${accuracy >= 80 ? 'üéâ ¬°Excelente trabajo!' : accuracy >= 60 ? 'üëç ¬°Buen progreso!' : 'üí™ ¬°Sigue practicando!'}
                            </h3>
                            <p class="text-gray-300">
                                ${accuracy >= 80 
                                    ? 'Tu nivel de comprensi√≥n es sobresaliente. ¬°Sigue as√≠!' 
                                    : accuracy >= 60 
                                        ? 'Vas por buen camino. Contin√∫a viendo m√°s videos para mejorar.' 
                                        : 'La pr√°ctica hace al maestro. Repasa los videos y presta atenci√≥n a los detalles.'}
                            </p>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('btn-back-stats').addEventListener('click', () => {
                renderDashboard(currentUser);
            });
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                await renderDashboard(user);
            } else {
                currentUser = null;
                renderLoginPage();
            }
        });

        window.showMessage = showMessage;
    </script>
</body>
</html>
